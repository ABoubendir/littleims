<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">

<Configure id="Server" class="org.eclipse.jetty.server.Server">
  
  <!-- *********************************************************** -->
  <!-- jetty-deploy.xml                                            -->
  <!-- *********************************************************** -->
  <Call name="addBean">
    <Arg>
      <New id="DeploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager">
        <Set name="contexts">
          <Ref refid="Contexts" />
        </Set>
        <Call name="setContextAttribute">
          <Arg>org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</Arg>
          <Arg>.*/servlet-api-[^/]*\.jar$</Arg>
        </Call>
      </New>
    </Arg>
  </Call>
  
  
  
  <!-- *********************************************************** -->
  <!-- cipango-diameter.xml                                        -->
  <!-- *********************************************************** -->
  <Array id="diameterConfig" type="java.lang.String">
    <Item>org.eclipse.jetty.webapp.WebInfConfiguration</Item>
    <Item>org.eclipse.jetty.webapp.WebXmlConfiguration</Item>
    <Item>org.eclipse.jetty.webapp.MetaInfConfiguration</Item>
    <Item>org.eclipse.jetty.webapp.FragmentConfiguration</Item>
    <Item>org.eclipse.jetty.plus.webapp.EnvConfiguration</Item>
    <Item>org.eclipse.jetty.webapp.JettyWebXmlConfiguration</Item>
    <Item>org.eclipse.jetty.webapp.TagLibConfiguration</Item>
    <Item>org.cipango.server.sipapp.SipXmlConfiguration</Item>
    <Item>org.cipango.diameter.app.DiameterConfiguration</Item>	
  </Array>
  
  <Ref id="DeploymentManager">
    <Call name="addAppProvider">
      <Arg>
        <New class="org.cipango.deploy.providers.SipAppProvider" id="SipAppProvider">
            <Set name="monitoredDirName"><Property name="jetty.home" default="." />/sipapps</Set>
            <Set name="defaultsDescriptor"><Property name="jetty.home" default="."/>/etc/webdefault.xml</Set>
            <Set name="defaultsSipDescriptor"><Property name="jetty.home" default="."/>/etc/sipdefault.xml</Set>
            <Set name="scanInterval">5</Set>
            <Set name="extractWars">true</Set>
            <Set name="configurationClasses"><Ref id="diameterConfig"/></Set>
            <Set name="configurationManager">
              <New class="org.eclipse.jetty.deploy.PropertiesConfigurationManager">
              <!-- file of context configuration properties
                <Set name="file"><SystemProperty name="jetty.home"/>/etc/some.properties</Set>
              -->
              <!-- set a context configuration property
                <Call name="put"><Arg>name</Arg><Arg>value</Arg></Call>
              -->
              </New>
            </Set>
          </New>
      </Arg>
      
    </Call>
  </Ref>
  
</Configure>
